{
    "className": "org.joget.apps.form.model.Form",
    "elements": [
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "SMTPHost",
                            "label": "SMTP Host<br/>(Example: smtp.gmail.com)",
                            "maxlength": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "40",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "SMTPPort",
                            "label": "SMTP Port<br/>(Example: 465)",
                            "maxlength": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "40",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "SMTPUsername",
                            "label": "SMTP Username<br/>(Example: yourname@gmail.com)",
                            "maxlength": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "40",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.PasswordField",
                        "properties": {
                            "id": "SMTPPassword",
                            "label": "SMTP Password<br/>(Example: password)",
                            "maxlength": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "40",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": ""
                        }
                    }
                ],
                "properties": {"width": "100%"}
            }],
            "properties": {
                "id": "section2",
                "label": "SMTP Configuration for Email Notifications",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "regex": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        },
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [{
                    "className": "org.joget.apps.form.lib.CustomHTML",
                    "properties": {
                        "autoPopulate": "",
                        "id": "field11",
                        "label": "",
                        "value": "<font style=\"font-size:80%\">\r\nThe above data are stored in this app's Environment Variable section in Joget Console.<br/><br/>\r\n<ul><li><font style=\"font-size:80%\">Properties & Export>Environment Variable\".<\/font><br/><\/li>\r\n<li><font style=\"font-size:80%\">Properties & Export>Plugin Default Properties>Email Tool\".<\/font><\/li>\r\n<\/ul>\r\n<br/>When you export this app, the above data will be saved and be imported into your new Joget platform.<\/font>"
                    }
                }],
                "properties": {"width": "100%"}
            }],
            "properties": {
                "id": "section3",
                "label": "Notes",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "regex": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        }
    ],
    "properties": {
        "description": "",
        "id": "setUpSMTP",
        "loadBinder": {
            "className": "org.joget.apps.form.lib.BeanShellFormBinder",
            "properties": {
                "script": "import java.util.Collection;\r\nimport org.joget.apps.app.dao.EnvironmentVariableDao;\r\nimport org.joget.apps.app.model.AppDefinition;\r\nimport org.joget.apps.app.model.EnvironmentVariable;\r\nimport org.joget.apps.app.service.AppUtil;\r\nimport org.joget.apps.form.model.Element;\r\nimport org.joget.apps.form.model.FormData;\r\nimport org.joget.apps.form.model.FormRow;\r\nimport org.joget.apps.form.model.FormRowSet;\r\nimport org.joget.commons.util.LogUtil;\r\n  \r\npublic FormRowSet load(Element element, String primaryKey, FormData formData) {\r\n    FormRowSet rows = new FormRowSet();\r\n    AppDefinition appDef = AppUtil.getCurrentAppDefinition();\r\n  \r\n    if (appDef != null) {\r\n        EnvironmentVariableDao environmentVariableDao = (EnvironmentVariableDao) AppUtil.getApplicationContext().getBean(\"environmentVariableDao\");\r\n        Collection environmentVariableList = environmentVariableDao.getEnvironmentVariableList(null, appDef, null, null, null, null);\r\n        \r\n        //loop the result and add to FormRow\r\n        if (environmentVariableList != null && environmentVariableList.size() > 0) {\r\n            FormRow r = new FormRow();\r\n             \r\n            for (EnvironmentVariable e : environmentVariableList) {\r\n                if (e.getValue() != null) {\r\n                    r.setProperty(e.getId(), e.getValue());\r\n                }\r\n            }\r\n             \r\n            rows.add(r);\r\n        }\r\n    }\r\n     \r\n    return rows;\r\n}\r\n  \r\n//call load method with injected variable\r\nreturn load(element, primaryKey, formData);",
                "useAjax": ""
            }
        },
        "name": "Set up SMTP",
        "noPermissionMessage": "",
        "permission": {
            "className": "",
            "properties": {}
        },
        "postProcessor": {
            "className": "",
            "properties": {}
        },
        "postProcessorRunOn": "both",
        "storeBinder": {
            "className": "org.joget.apps.form.lib.BeanShellFormBinder",
            "properties": {
                "script": "import org.joget.apps.app.dao.EnvironmentVariableDao;\r\nimport org.joget.apps.app.model.AppDefinition;\r\nimport org.joget.apps.app.model.EnvironmentVariable;\r\nimport org.joget.apps.app.service.AppUtil;\r\nimport org.joget.apps.form.model.Element;\r\nimport org.joget.apps.form.model.FormData;\r\nimport org.joget.apps.form.model.FormRow;\r\nimport org.joget.apps.form.model.FormRowSet;\r\nimport org.joget.apps.form.model.FormStoreBinder;\r\nimport org.joget.plugin.base.PluginManager;\r\n   \r\npublic FormRowSet store(Element element, FormRowSet rows, FormData formData) {\r\n    //check the rows is not empty before store it\r\n    if (rows != null && !rows.isEmpty()) {\r\n        AppDefinition appDef = AppUtil.getCurrentAppDefinition();\r\n        EnvironmentVariableDao environmentVariableDao = (EnvironmentVariableDao) AppUtil.getApplicationContext().getBean(\"environmentVariableDao\");\r\n         \r\n        //Get the submitted data\r\n        FormRow row = rows.get(0);\r\n        \r\n        //Add / Update each Environment Variable\r\n        for (Object key : row.keySet()) {\r\n            String envId = (String) key;\r\n            String value = row.getProperty(envId);\r\n             \r\n            if (!envId.isEmpty()){\r\n                EnvironmentVariable e = environmentVariableDao.loadById(envId, appDef);\r\n                if (e != null) {\r\n                    e.setValue(value);\r\n                    environmentVariableDao.update(e);\r\n                } else {\r\n                    EnvironmentVariable e = new EnvironmentVariable();\r\n                    e.setAppDefinition(appDef);\r\n                    e.setId(envId);\r\n                    e.setValue(value);\r\n                    environmentVariableDao.add(e);\r\n                }\r\n            }\r\n        }\r\n    }\r\n     \r\n    return rows;\r\n}\r\n  \r\n//call store method with injected variable\r\nreturn store(element, rows, formData);",
                "useAjax": ""
            }
        },
        "tableName": "setUpSMTP"
    }
}